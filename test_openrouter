#!/usr/bin/env python3
"""
Test OpenRouter Integration
Quick test to verify OpenRouter is working
"""

import sys
import os
from dotenv import load_dotenv

sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from post_generator import load_company_docs, generate_post, format_post_for_platform


def main():
    load_dotenv()

    print("üß™ Testing OpenRouter Integration")
    print("="*60)

    # Check configuration
    use_openrouter = os.getenv('USE_OPENROUTER', 'false').lower() == 'true'

    if use_openrouter:
        print("‚úì OpenRouter mode: ENABLED")
        api_key = os.getenv('OPENROUTER_API_KEY')
        if api_key:
            print(f"‚úì OpenRouter API key: {api_key[:15]}...{api_key[-4:]}")
        else:
            print("‚ùå OpenRouter API key: NOT FOUND")
            return
    else:
        print("‚ö†Ô∏è  OpenRouter mode: DISABLED")
        print("   To enable: Set USE_OPENROUTER=true in .env")
        api_key = os.getenv('OPENAI_API_KEY')
        if api_key:
            print(f"‚úì Using OpenAI directly: {api_key[:15]}...{api_key[-4:]}")
        else:
            print("‚ùå OpenAI API key: NOT FOUND")
            return

    print("="*60)
    print("\nüìù Generating a test post...")

    try:
        # Load docs and generate post
        docs = load_company_docs()
        post = generate_post(docs, post_type="thought_leadership", platform="mastodon")

        formatted = format_post_for_platform(post)

        print("\n‚úÖ Success! Generated post:")
        print("="*60)
        print(formatted)
        print("="*60)
        print(f"\nCharacter count: {len(formatted)}/500")

        if use_openrouter:
            print("\nüéâ OpenRouter is working perfectly!")
            print("You can now use different AI models by changing the model parameter.")
        else:
            print("\n‚úÖ OpenAI direct mode is working!")
            print("To try OpenRouter, set USE_OPENROUTER=true in .env")

    except Exception as e:
        print(f"\n‚ùå Error: {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    main()
